/**
 * *McdJS* - 用 JS 编写你的指令！
 * @module mcdjs
 * @version 0.9.4
 * @license GPL-2.0-or-later
 * @see https://mcd.js.org/ 介绍页面
 */
/// <reference path="../lib-splited/index.ts" />
((exp)=>{/*! For license information please see packed.js.LICENSE.txt */
(()=>{var e={381:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,o),n(r)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}y(e,t,o,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&y(e,"error",t,{once:!0})}(e,i)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function u(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,r,n){var i,o,s,c;if(a(r),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),o=e._events),s=o[t]),void 0===s)s=o[t]=r,++e._eventsCount;else if("function"==typeof s?s=o[t]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),(i=u(e))>0&&s.length>i&&!s.warned){s.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=e,f.type=t,f.count=s.length,c=f,console&&console.warn&&console.warn(c)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function l(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=f.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):h(i,i.length)}function d(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function h(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function y(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){n.once&&e.removeEventListener(t,i),r(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return u(this)},o.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=o[e];if(void 0===u)return!1;if("function"==typeof u)n(u,this,t);else{var c=u.length,f=h(u,c);for(r=0;r<c;++r)n(f[r],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,l(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,l(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,i,o,s;if(a(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===t||r[o].listener===t){s=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):d.call(e,t)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},929:(e,t,r)=>{var n;!function(e){!function(t){var n="object"==typeof r.g?r.g:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),i=o(e);function o(e,t){return function(r,n){"function"!=typeof e[r]&&Object.defineProperty(e,r,{configurable:!0,writable:!0,value:n}),t&&t(r,n)}}void 0===n.Reflect?n.Reflect=e:i=o(n.Reflect,i),function(e){var t=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,n=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",i=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",o="function"==typeof Object.create,s={__proto__:[]}instanceof Array,a=!o&&!s,u={create:o?function(){return I(Object.create(null))}:s?function(){return I({__proto__:null})}:function(){return I({})},has:a?function(e,r){return t.call(e,r)}:function(e,t){return t in e},get:a?function(e,r){return t.call(e,r)?e[r]:void 0}:function(e,t){return e[t]}},c=Object.getPrototypeOf(Function),f="object"==typeof process&&process.env&&"true"===process.env.REFLECT_METADATA_USE_MAP_POLYFILL,l=f||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function(){var e={},t=[],r=function(){function e(e,t,r){this._index=0,this._keys=e,this._values=t,this._selector=r}return e.prototype["@@iterator"]=function(){return this},e.prototype[i]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var r=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var r=this._find(e,!0);return this._values[r]=t,this},t.prototype.delete=function(t){var r=this._find(t,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new r(this._keys,this._values,n)},t.prototype.values=function(){return new r(this._keys,this._values,o)},t.prototype.entries=function(){return new r(this._keys,this._values,s)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[i]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function n(e,t){return e}function o(e,t){return t}function s(e,t){return[e,t]}}():Map,p=f||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function(){function e(){this._map=new l}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[i]=function(){return this.keys()},e}():Set,d=new(f||"function"!=typeof WeakMap?function(){var e=16,r=u.create(),n=i();return function(){function e(){this._key=i()}return e.prototype.has=function(e){var t=o(e,!1);return void 0!==t&&u.has(t,this._key)},e.prototype.get=function(e){var t=o(e,!1);return void 0!==t?u.get(t,this._key):void 0},e.prototype.set=function(e,t){return o(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=o(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=i()},e}();function i(){var e;do{e="@@WeakMap@@"+a()}while(u.has(r,e));return r[e]=!0,e}function o(e,r){if(!t.call(e,n)){if(!r)return;Object.defineProperty(e,n,{value:u.create()})}return e[n]}function s(e,t){for(var r=0;r<t;++r)e[r]=255*Math.random()|0;return e}function a(){var t,r=(t=e,"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):s(new Uint8Array(t),t):s(new Array(t),t));r[6]=79&r[6]|64,r[8]=191&r[8]|128;for(var n="",i=0;i<e;++i){var o=r[i];4!==i&&6!==i&&8!==i||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}():WeakMap);function h(e,t,r){var n=d.get(e);if(w(n)){if(!r)return;n=new l,d.set(e,n)}var i=n.get(t);if(w(i)){if(!r)return;i=new l,n.set(t,i)}return i}function y(e,t,r){if(g(e,t,r))return!0;var n=A(t);return!x(n)&&y(e,n,r)}function g(e,t,r){var n=h(t,r,!1);return!w(n)&&!!n.has(e)}function v(e,t,r){if(g(e,t,r))return m(e,t,r);var n=A(t);return x(n)?void 0:v(e,n,r)}function m(e,t,r){var n=h(t,r,!1);if(!w(n))return n.get(e)}function _(e,t,r,n){h(r,n,!0).set(e,t)}function b(e,t){var r=O(e,t),n=A(e);if(null===n)return r;var i=b(n,t);if(i.length<=0)return r;if(r.length<=0)return i;for(var o=new p,s=[],a=0,u=r;a<u.length;a++){var c=u[a];o.has(c)||(o.add(c),s.push(c))}for(var f=0,l=i;f<l.length;f++)c=l[f],o.has(c)||(o.add(c),s.push(c));return s}function O(e,t){var r=[],n=h(e,t,!1);if(w(n))return r;for(var o=function(e){var t=N(e,i);if(!k(t))throw new TypeError;var r=t.call(e);if(!M(r))throw new TypeError;return r}(n.keys()),s=0;;){var a=S(o);if(!a)return r.length=s,r;var u=a.value;try{r[s]=u}catch(e){try{z(o)}finally{throw e}}s++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function w(e){return void 0===e}function x(e){return null===e}function M(e){return"object"==typeof e?null!==e:"function"==typeof e}function T(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var r=3===t?"string":5===t?"number":"default",i=N(e,n);if(void 0!==i){var o=i.call(e,r);if(M(o))throw new TypeError;return o}return function(e,t){if("string"===t){var r=e.toString;if(k(r)&&!M(i=r.call(e)))return i;if(k(n=e.valueOf)&&!M(i=n.call(e)))return i}else{var n;if(k(n=e.valueOf)&&!M(i=n.call(e)))return i;var i,o=e.toString;if(k(o)&&!M(i=o.call(e)))return i}throw new TypeError}(e,"default"===r?"number":r)}function P(e){var t=T(e,3);return"symbol"==typeof t?t:function(e){return""+e}(t)}function j(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function k(e){return"function"==typeof e}function C(e){return"function"==typeof e}function N(e,t){var r=e[t];if(null!=r){if(!k(r))throw new TypeError;return r}}function S(e){var t=e.next();return!t.done&&t}function z(e){var t=e.return;t&&t.call(e)}function A(e){var t=Object.getPrototypeOf(e);if("function"!=typeof e||e===c)return t;if(t!==c)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return t;var i=n.constructor;return"function"!=typeof i||i===e?t:i}function I(e){return e.__=void 0,delete e.__,e}e("decorate",(function(e,t,r,n){if(w(r)){if(!j(e))throw new TypeError;if(!C(t))throw new TypeError;return function(e,t){for(var r=e.length-1;r>=0;--r){var n=(0,e[r])(t);if(!w(n)&&!x(n)){if(!C(n))throw new TypeError;t=n}}return t}(e,t)}if(!j(e))throw new TypeError;if(!M(t))throw new TypeError;if(!M(n)&&!w(n)&&!x(n))throw new TypeError;return x(n)&&(n=void 0),function(e,t,r,n){for(var i=e.length-1;i>=0;--i){var o=(0,e[i])(t,r,n);if(!w(o)&&!x(o)){if(!M(o))throw new TypeError;n=o}}return n}(e,t,r=P(r),n)})),e("metadata",(function(e,t){return function(r,n){if(!M(r))throw new TypeError;if(!w(n)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;_(e,t,r,n)}})),e("defineMetadata",(function(e,t,r,n){if(!M(r))throw new TypeError;return w(n)||(n=P(n)),_(e,t,r,n)})),e("hasMetadata",(function(e,t,r){if(!M(t))throw new TypeError;return w(r)||(r=P(r)),y(e,t,r)})),e("hasOwnMetadata",(function(e,t,r){if(!M(t))throw new TypeError;return w(r)||(r=P(r)),g(e,t,r)})),e("getMetadata",(function(e,t,r){if(!M(t))throw new TypeError;return w(r)||(r=P(r)),v(e,t,r)})),e("getOwnMetadata",(function(e,t,r){if(!M(t))throw new TypeError;return w(r)||(r=P(r)),m(e,t,r)})),e("getMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return w(t)||(t=P(t)),b(e,t)})),e("getOwnMetadataKeys",(function(e,t){if(!M(e))throw new TypeError;return w(t)||(t=P(t)),O(e,t)})),e("deleteMetadata",(function(e,t,r){if(!M(t))throw new TypeError;w(r)||(r=P(r));var n=h(t,r,!1);if(w(n))return!1;if(!n.delete(e))return!1;if(n.size>0)return!0;var i=d.get(t);return i.delete(r),i.size>0||d.delete(t),!0}))}(i)}()}(n||(n={}))},750:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(r(434),t);var o=r(434);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.OrganizerAsync}})},434:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i(r(125),t),i(r(11),t),i(r(53),t),i(r(223),t);var o=r(223);Object.defineProperty(t,"default",{enumerable:!0,get:function(){return o.OrganizerSync}}),i(r(187),t),i(r(667),t),i(r(528),t),i(r(166),t)},125:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CircleChecker=t.SignChecker=void 0;const n=r(223),i=r(528);class o{ensureds=new Set;requireds=new Set;countEnsureds(){return this.ensureds.size}getEnsureds(){return new Set(this.ensureds)}isEnsured(e){return this.ensureds.has(e)}isRequired(e){return this.requireds.has(e)}ensure(...e){e.forEach((e=>{this.ensureds.add(e),this.requireds.delete(e)}))}require(...e){e.forEach((e=>this.ensureds.has(e)||this.requireds.add(e)))}tryThrow(){this.requireds.size&&(0,i.throwError)(3,Error("出现了未注册的模块"),{list:this.requireds})}}t.SignChecker=o,t.CircleChecker=class{edgeMap;circle=[];checkedChecker=new o;out(e){return this.circle.splice(0,this.circle.indexOf(e)),!0}mark(e){this.checkedChecker.require(e),this.circle.push(e)}unmark(e){this.checkedChecker.ensure(e),this.circle.pop()}from(e){if(this.checkedChecker.isEnsured(e))return!1;if(this.checkedChecker.isRequired(e))return this.out(e);this.mark(e);for(const t of this.edgeMap[e])if(this.from(t))return!0;return this.unmark(e),!1}throw(){this.tryThrow()}tryThrow(){(0,i.throwError)(2,Error("出现环形引用"),{circle:this.circle})}constructor(e){this.edgeMap=e,this.from(n.Organizer.start)||(this.tryThrow=()=>{})}}},11:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Diagram=void 0;const n=r(223);t.Diagram=class{idList;edgeMap;constructor(e,t){this.idList=e,this.edgeMap=t}dotLine(e,t,r,n=1){return["\t".repeat(n),`"${e.toString()}" -> "${t.toString()}"`].join("")}dotSignCache=null;getDotSignPrune(){return this.dotSignCache||(this.dotSignCache=new Set([this.dotLine(n.Organizer.start,n.Organizer.end),this.idList.filter((e=>e!==n.Organizer.end&&e!==n.Organizer.start)).map((e=>{switch(n.Organizer.getHookedPartOf(e)){case"All":return[this.dotLine(e,n.Organizer.end),this.dotLine(n.Organizer.start,e)];case"Post":return this.dotLine(e,n.Organizer.end);case"Pre":return this.dotLine(n.Organizer.start,e);case"Body":return[]}}))].flat(3)))}dotCache=null;getDotPrune(){return this.dotCache||(this.dotCache=new Set(this.idList.map((e=>this.edgeMap[e].map((t=>({a:e,b:t}))))).flat().filter((({a:e,b:t})=>4===new Set([e,t,n.Organizer.end,n.Organizer.start]).size)).map((({a:e,b:t})=>this.dotLine(e,t)))))}getDot(e){return["digraph loader {",...this.getDotPrune(),...e?this.getDotSignPrune():[],"}"].join("\n")}getUrl(e){return`http://dreampuf.github.io/GraphvizOnline/#${encodeURIComponent(this.getDot(e))}`}}},53:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Executor=t.Graph=void 0;const n=r(125),i=r(223);t.Graph=class{splitedChecker;edgeMap=Object.create(null);indegreeMap=Object.create(null);putInList(e,t){(this.edgeMap[e]||(this.edgeMap[e]=[])).push(...t)}plusCount(e,t=1){this.indegreeMap[e]=(this.indegreeMap[e]||0)+t}insertAfter(e,t){t.forEach((t=>this.putInList(t,[e]))),this.plusCount(e,t.length)}insertBefore(e,t){this.putInList(e,t),t.forEach((e=>this.plusCount(e)))}insert(e,t,r){this.insertAfter(e,t),this.insertBefore(e,r)}getEdgeOf(e,t){return"symbol"!=typeof e&&this.splitedChecker.isEnsured(e)?this.getEdgeOf(i.Organizer[`affix${t}`]+e,t):e}insertEdge(e,t,r){this.insertAfter(this.getEdgeOf(e,"Pre"),t.map((e=>this.getEdgeOf(e,"Post")))),this.insertBefore(this.getEdgeOf(e,"Post"),r.map((e=>this.getEdgeOf(e,"Pre"))))}linkSymbol(e){switch(i.Organizer.getHookedPartOf(e)){case"All":return this.insert(e,[i.Organizer.start],[i.Organizer.end]);case"Post":return this.insert(e,[],[i.Organizer.end]);case"Pre":return this.insert(e,[i.Organizer.start],[])}}constructor(e,t){this.splitedChecker=t,e.forEach((({after:e,before:t},r)=>this.insertEdge(r,[...e],[...t]))),[...e.keys()].filter((e=>e!==i.Organizer.end&&e!==i.Organizer.start)).forEach((e=>this.linkSymbol(e))),t.getEnsureds().forEach((e=>this.insertEdge(i.Organizer.affixMain+e,[i.Organizer.affixPre+e],[i.Organizer.affixPost+e]))),this.indegreeMap[i.Organizer.start]=1;const r=new n.CircleChecker(this.edgeMap);this.tryThrow=()=>r.tryThrow()}tryThrow;getExecutor(e){return new o(this.edgeMap,this.indegreeMap,e)}};class o{edgeMap;workRunner;constructor(e,t,r){this.edgeMap=e,this.workRunner=r,this.indegreeMap=Object.create(t)}indegreeMap;executeSyncSub(e){--this.indegreeMap[e]||(this.workRunner.runSync(e),this.edgeMap[e].forEach((e=>this.executeSyncSub(e))))}executeSync(){return this.executeSyncSub(i.Organizer.start),this.workRunner.data}limiter=null;async executeAsyncSub(e){--this.indegreeMap[e]||(await this.workRunner.runAsync(e,this.limiter),await Promise.all(this.edgeMap[e].map((e=>this.executeAsyncSub(e)))))}async executeAsync(e){return this.limiter=e,await this.executeAsyncSub(i.Organizer.start),this.workRunner.data}}t.Executor=o},223:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.OrganizerSync=t.OrganizerAsync=t.Organizer=t.AffixsToolKit=void 0;const i=n(r(321)),o=r(187),s=r(528),a=r(166);class u{static hookTypes=["Pre","Main","Post"];static _affixPre="pre:";static get affixPre(){return this._affixPre}static set affixPre(e){this.setAffix("Pre",e)}static _affixMain="main:";static get affixMain(){return this._affixMain}static set affixMain(e){this.setAffix("Main",e)}static _affixPost="post:";static get affixPost(){return this._affixPost}static set affixPost(e){this.setAffix("Post",e)}static setAffix(e,t){this[`_affix${e}`]=t,this.affixs=this.getAffixs(),this.hookTypeMap=this.getHookTypeMap()}static affixs=this.getAffixs();static getAffixedOf(e){return{preId:this._affixPre+e,mainId:this._affixMain+e,postId:this._affixPost+e}}static getAffixed(e){return this.getAffixedOf(e)}static getAffixs(){return[this._affixPre,this._affixMain,this._affixPost]}static getHookTypeMap(){return{[this._affixPre]:"Pre",[this._affixMain]:"Main",[this._affixPost]:"Post"}}static hookTypeMap=this.getHookTypeMap();static getHookTypeOf(e){if("string"!=typeof e)return!1;for(const t of c.affixs)if(e.slice(0,t.length)===t)return this.hookTypeMap[t];return!1}static getHookType(e){return this.getHookTypeOf(e)}static getHookedOf(e){if("string"!=typeof e)return!1;for(const t of c.affixs)if(e.slice(0,t.length)===t)return e.slice(t.length);return!1}static ensureHookedPart(e,t){const r=c.getHookTypeOf(e);return r?r!==t?"Body":this.ensureHookedPart(c.getHookedOf(e),t):t}static getHookedPartOf(e){if("symbol"==typeof e)return"All";const t=c.getHookTypeOf(e);return t&&"Main"!==t?this.ensureHookedPart(c.getHookedOf(e),t):"Body"}}t.AffixsToolKit=u;class c extends u{static start=Symbol("load start");static end=Symbol("load end");static unknown=Symbol("unknown module");constructor({workers:e={},positions:t={},reusable:r}={}){super(),void 0!==r&&(this.reusable=r),this.addWorkers(e),this.addPositions(t)}reusable=!0;loaded=!1;positionMap=new o.PositionMap;addPosition(e,t={},r=null){return r&&this.addWorker(e,r),this.positionMap.insert(e,t),this}addPositions(e){return(0,s.isArray)(e)?((0,s.isIdArray)(e)?[e]:e).forEach((e=>{this.addPosition(e[0]),e.length<2||e.reduce(((e,t)=>(this.addPosition(t,e),t)))})):(0,s.mapMap)(e,((e,t)=>this.addPosition(t,e))),this}workerManager=new a.WorkerManager;addWorker(e,t,r){return r||this.positionMap.insert(e,{}),this.workerManager.add(e,t),this}addWorkers(e,t){return(0,s.mapMap)(e,((e,r)=>this.addWorker(r,e,t))),this}tryThrow(){this.positionMap.tryThrow()}getExecutor(e){return this.positionMap.getGraph().getExecutor(this.workerManager.getRunner(e))}execute(e){return!(this.reusable||!this.loaded)||(this.tryThrow(),this.loaded=!0,!1)}getDiagram(){return this.positionMap.getDiagram()}}t.Organizer=c,t.OrganizerAsync=class extends c{constructor({concurrency:e=0,...t}={}){super(t),this.concurrency=e}concurrency;execute(e,t={}){return super.execute()?e:this.getExecutor(e).executeAsync(new i.default(t))}},t.OrganizerSync=class extends c{execute(e){return super.execute()?e:this.getExecutor(e).executeSync()}}},187:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PositionMap=t.PositionObj=t.SurePosition=void 0;const n=r(125),i=r(11),o=r(53),s=r(223),a=r(528);class u{static keys=["after","before"];static fillSet(e){u.keys.forEach((t=>e[t]||(e[t]=new Set)))}static fill(e){return this.fillSet(e),e}constructor(e){const t=(0,a.getArray)(e.preOf||[]),r=(0,a.getArray)(e.postOf||[]);this.after=new Set([...(0,a.getArray)(e.after||[]),...t.map((e=>s.Organizer.affixPre+e)),...r.map((e=>s.Organizer.affixMain+e))]),this.before=new Set([...(0,a.getArray)(e.before||[]),...t.map((e=>s.Organizer.affixMain+e)),...r.map((e=>s.Organizer.affixPost+e))])}after;before}t.SurePosition=u;class c{static keys=[...u.keys,"preOf","postOf"];constructor(e){if("object"!=typeof e&&(e=[e]),!("length"in e))return e;this.after=e}preJudger;postJudger;after;before;preOf;postOf}t.PositionObj=c,t.PositionMap=class{constructor(){this.insertedChecker.ensure(s.Organizer.start,s.Organizer.end),this.insert(s.Organizer.end,s.Organizer.start)}insertedChecker=new n.SignChecker;countMap=new Map;surePositionMap=new a.SurePositionMap;push(e,t){const r=this.surePositionMap.forceGet(e);u.keys.forEach((e=>t[e].forEach((t=>r[e].add(t)))));const n=r.after.size+r.before.size;return this.countMap.set(e,n),n}splitedChecker=new n.SignChecker;surelyInsert(e,t){if("symbol"==typeof e||!this.splitedChecker.isEnsured(e))return this.push(e,t);const{preId:r,mainId:n,postId:i}=s.Organizer.getAffixedOf(e),o=this.countMap.get(n)+this.surelyInsert(r,u.fill({after:t.after}))+this.surelyInsert(i,u.fill({before:t.before}));return this.countMap.set(e,o),o}split(e){const{preId:t,mainId:r,postId:n}=s.Organizer.getAffixedOf(e);this.splitedChecker.ensure(e),this.insertedChecker.ensure(t,r,n),this.push(t,u.fill({after:this.surePositionMap.get(e)?.after})),this.push(r,new u({})),this.push(n,u.fill({before:this.surePositionMap.get(e)?.before})),this.surePositionMap.delete(e)}requireSplited(e){return!(!1===e||this.splitedChecker.isRequired(e)||!this.splitedChecker.isEnsured(e)&&(this.requireSplited(s.Organizer.getHookedOf(e))?(this.split(e),0):(this.splitedChecker.require(e),1)))}clearHolded(e){this.split(e),s.Organizer.affixs.forEach((t=>this.splitedChecker.isRequired(t+e)&&this.clearHolded(t+e)))}ensureSplited(e){return"symbol"==typeof e?(this.insertedChecker.ensure(e),!1):!1===e||!this.splitedChecker.isEnsured(e)&&(this.splitedChecker.isRequired(e)?(this.ensureSplited(s.Organizer.getHookedOf(e))&&(this.insertedChecker.ensure(e),this.clearHolded(e)),!1):(this.ensureSplited(s.Organizer.getHookedOf(e))&&this.insertedChecker.ensure(e),this.split(e),!1))}insert(e,t){const r=this.insertedChecker.countEnsureds(),n=this.countMap.get(e),i=new u(new c(t));i.before.has(s.Organizer.start)&&(this.insertError=[0,e]),i.after.has(s.Organizer.end)&&(this.insertError=[1,e]),u.keys.forEach((e=>this.insertedChecker.require(...i[e]))),u.keys.forEach((e=>i[e]?.forEach((e=>this.requireSplited(s.Organizer.getHookedOf(e)))))),this.ensureSplited(e),this.surelyInsert(e,i),this.insertedChecker.countEnsureds()===r&&this.countMap.get(e)===n||this.clearCache()}clearCache(){this.graphCache=null,this.diagramCache=null}graphCache=null;getGraph(){return this.graphCache||(this.graphCache=new o.Graph(this.surePositionMap,this.splitedChecker))}diagramCache=null;getDiagram(){return this.diagramCache||(this.diagramCache=new i.Diagram([...this.surePositionMap.keys()],this.getGraph().edgeMap))}insertError=null;throwInsertError(){if(!this.insertError)return;const[e,t]=this.insertError;(0,a.throwError)(this.insertError[0],Error(`在 ${e?"Organizer.end 后":"Organizer.start 前"}插入位置`),{id:t})}tryThrow(){this.throwInsertError(),this.insertedChecker.tryThrow(),this.getGraph().tryThrow()}}},667:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},528:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapMap=t.mapMapObj=t.isIdArray=t.getArray=t.isArray=t.throwError=t.AocudeoError=t.ErrorType=t.ArrayMap=t.SurePositionMap=t.InitializableMap=void 0;const n=r(187);class i extends Map{forceGet(e){let t=this.get(e);return t||(t=this.initializeValue(),this.set(e,t),t)}}var o;t.InitializableMap=i,t.SurePositionMap=class extends i{initializeValue(){return new n.SurePosition({})}},t.ArrayMap=class extends i{initializeValue(){return[]}push(e,...t){this.forceGet(e).push(...t)}},function(e){e[e.InsertBeforeStart=0]="InsertBeforeStart",e[e.InsertAfterEnd=1]="InsertAfterEnd",e[e.CircularReference=2]="CircularReference",e[e.UnregistedCodeUnits=3]="UnregistedCodeUnits"}(o||(t.ErrorType=o={}));class s{constructor(e,t,r){this.type=o[e],Object.assign(this,r),this.tracker=t}type}function a(e,t){Reflect.ownKeys(e).forEach((r=>{const n=e[r];void 0!==n&&t(n,r)}))}t.AocudeoError=s,t.throwError=function(e,t,r){throw new s(e,t,r)},t.isArray=Array.isArray,t.getArray=function(e){return(0,t.isArray)(e)?e:[e]},t.isIdArray=function(e){return"object"!=typeof e[0]},t.mapMapObj=a,t.mapMap=function(e,t){e instanceof Map?e.forEach(t):a(e,t)}},166:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerManager=t.WorkerRunner=t.WorkerContext=void 0;const n=r(223),i=r(528);class o{id;maker;constructor(e,t){this.id=e,this.maker=t}get data(){return this.maker.data}set data(e){this.maker.data=e}}t.WorkerContext=o;class s{workerMap;data;constructor(e,t){this.workerMap=e,this.data=t}doFnSync(e){this.workerMap.get(e)?.forEach((t=>t(new o(e,this))))}runSync(e){if(this.doFnSync(e),"Main"===n.Organizer.getHookTypeOf(e))return this.runSync(n.Organizer.getHookedOf(e))}doFnAsync(e){return Promise.all(this.workerMap.get(e)?.map((t=>t(new o(e,this)))))}async runAsync(e,t){if(this.workerMap.has(e)){const r=await t.hold();await this.doFnAsync(e),r()}if("Main"===n.Organizer.getHookTypeOf(e))return this.runAsync(n.Organizer.getHookedOf(e),t)}}t.WorkerRunner=s,t.WorkerManager=class{workerMap=new i.ArrayMap;add(e,t){"run"in t&&(t=t.run),t instanceof Array||(t=[t]),t.length&&this.workerMap.push(e,...t)}getRunner(e){return new s(this.workerMap,e)}}},450:()=>{"use strict";!function(e){let t;!function(t){t.CodeBlock=e.libs.internalTemp.CodeBlock,t.Command=e.libs.internalTemp.Command,t.Branch=e.libs.internalTemp.Branch,t.CBGroup=e.libs.internalTemp.CBGroup,t.NameSpace=e.libs.internalTemp.NameSpace,t.CommandRslt=e.libs.internalTemp.CommandRslt,t.Selector=e.libs.internalTemp.Selector,t.ExpressionAnd=e.libs.internalTemp.ExpressionAnd,t.ExpressionOr=e.libs.internalTemp.ExpressionOr,t.ExpressionNot=e.libs.internalTemp.ExpressionNot,t.ExpressionNand=e.libs.internalTemp.ExpressionNand,t.ExpressionNor=e.libs.internalTemp.ExpressionNor,t.ExpressionXor=e.libs.internalTemp.ExpressionXor,t.ExpressionXnor=e.libs.internalTemp.ExpressionXnor}(t=e.Node||(e.Node={}))}(globalThis.McdJSPort||{})},377:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0});const a=o(r(377));s(r(316),t),s(r(906),t),globalThis.McdJSPort.libs.internalTemp=a,r(450)},316:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.getExpression=t.ExpressionXnor=t.ExpressionXor=t.ExpressionNor=t.ExpressionNand=t.ExpressionNot=t.ExpressionOr=t.ExpressionAnd=t.Selector=t.CommandRslt=t.NameSpace=t.CBGroup=t.Branch=t.Command=t.CodeBlock=void 0,r(929);const i=r(776),o=r(610),s=r(549);class a extends o.Base{ntype=o.NType.CodeBlock;static"zh-CN"="代码块";constructor(e,t){super(e);const r=e.scope;e.scope=this,t(),e.scope=r}nodes=[]}t.CodeBlock=a,n([o.NodeAttr],a.prototype,"nodes",void 0);class u extends o.Base{exec;cond;ntype=o.NType.Command;static"zh-CN"="单命令";constructor(e,t,r=!1){super(e),this.exec=t,this.cond=r}}t.Command=u;class c extends o.Base{ntype=o.NType.Branch;static"zh-CN"="条件分支";constructor(e,t,r,n){super(e),this.cond=x(e,t),this.tdo=new a(e,r),this.fdo=new a(e,n)}cond;tdo;fdo}t.Branch=c,n([o.NodeAttr],c.prototype,"cond",void 0),n([o.NodeAttr],c.prototype,"tdo",void 0),n([o.NodeAttr],c.prototype,"fdo",void 0);class f extends o.Base{repeat;tick;ntype=o.NType.CBGroup;static"zh-CN"="命令方块组";constructor(e,t,r){super(e),this.repeat=t,this.tick=r}cbs=[]}t.CBGroup=f,n([o.NodeAttr],f.prototype,"cbs",void 0);class l extends o.Base{ntype=o.NType.NameSpace;static"zh-CN"="命名空间";constructor(e,t,r){super(e),this.sign=t,this.content=new a(e,r)}sign;content}t.NameSpace=l,n([o.NodeAttr],l.prototype,"content",void 0);class p extends o.Base{check;ntype=o.NType.CommandRslt;static"zh-CN"="命令条件";constructor(e,t){super(e),this.check=t}}t.CommandRslt=p;class d extends o.Base{range;simData;ntype=o.NType.Selector;static"zh-CN"="选中的人";constructor(e,t="@e",r){super(e),this.range=t,this.simData=r}}t.Selector=d;class h extends o.Base{constructor(e,t){super(e),this.a=t}a}n([o.NodeAttr],h.prototype,"a",void 0);class y extends o.Base{constructor(e,t,r){super(e),this.a=t,this.b=r}a;b}n([o.NodeAttr],y.prototype,"a",void 0),n([o.NodeAttr],y.prototype,"b",void 0);class g extends y{ntype=o.NType.ExpressionAnd;static"zh-CN"="与表达式"}t.ExpressionAnd=g;class v extends y{ntype=o.NType.ExpressionOr;static"zh-CN"="或表达式"}t.ExpressionOr=v;class m extends h{ntype=o.NType.ExpressionNot;static"zh-CN"="非表达式"}t.ExpressionNot=m;class _ extends y{ntype=o.NType.ExpressionNand;static"zh-CN"="与非表达式"}t.ExpressionNand=_;class b extends y{ntype=o.NType.ExpressionNor;static"zh-CN"="或非表达式"}t.ExpressionNor=b;class O extends y{ntype=o.NType.ExpressionXor;static"zh-CN"="异或表达式"}t.ExpressionXor=O;class E extends y{ntype=o.NType.ExpressionXnor;static"zh-CN"="同或表达式"}t.ExpressionXnor=E;const w={and:g,"&":g,or:v,"|":v,not:m,"!":m,nand:_,nor:b,xor:O,xnor:E};function x(e,t){if("string"==typeof t)return new d(e,t);if("tid"in t)switch(t.tid){case s.TypeId.CommandRslt:return new p(e,t.index);case s.TypeId.Selected:return x(e,t.expr);case s.TypeId.SimTag:return new d(e,void 0,t)}return 2===t.length?new w[t[0]](e,x(e,t[1])):3===t.length?new w[t[1]](e,x(e,t[0]),x(e,t[2])):(0,i.throwErr)(i.EType.ErrIllegalParameter,Error(),t)}t.getExpression=x},906:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(610),i=r(319),o=r(537);o.organizer.addWorker("internal-pack",(async({data:e})=>{const t=new n.Node.CBGroup(e,!1,0);e.ast.nodes.push(t),e.walk({all(e){(0,i.guard)(e.sureDad(n.NType.System)&&e.notSure(n.NType.CBGroup)),t.cbs.push(e.node),e.remove()}}),e.walk({all(e){(0,i.guard)(e.sure(n.NType.CBGroup)),e.node.cbs.length||e.remove()}})})),o.organizer.addPosition("internal-cond",{},(async({data:e})=>{}))},525:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getCmdobj=void 0;const o=r(695),s=i(r(184));var a=o.globalify.Export;class u extends s.default{Command=c(this.opering)}function c(e){function t(t){const r=e.getNode("Command",t);return e.push(r)}return{say:function(e){return t(`say ${e}`)},tag:function(e,r,n=""){return t(`tag ${e} ${r} ${n}`)}}}t.default=u,n([a],u.prototype,"Command",void 0),t.getCmdobj=c},723:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(695),s=i(r(525));var a=o.globalify.Export;class u extends s.default{If(e,t,r=(()=>{})){const n=this.opering.getNode("Branch",e,t,r);return this.opering.push(n)}}t.default=u,n([a],u.prototype,"If",null)},934:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(723));t.default=function(e){return new i.default(e)}},54:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.select=t.xnor=t.xor=t.nor=t.nand=t.not=t.or=t.and=t.XNOR=t.XOR=t.NOR=t.NAND=t.NOT=t.OR=t.AND=t.Tag=t.tagExist=t.SelectedClass=t.CommandRsltClass=void 0;const s=r(695),a=r(776),u=r(549),c=o(r(54)),f=[];function l(e){f.push(e)}function p(){}l("default"),p.prototype=c,t.default=p,t.CommandRsltClass=class{index;constructor(e){this.index=e}tid=u.TypeId.CommandRslt};class d{expr;constructor(e){this.expr=e}tid=u.TypeId.Selected}function h(e,t){if(!t.length)return(0,a.throwErr)(a.EType.ErrIllegalParameter,Error(),t);let r=t.shift();return t.forEach((t=>r=[r,e,t])),r}function y(...e){return h(t.AND,e)}t.SelectedClass=d,l("tagExist"),t.tagExist={},t.Tag=class{name;constructor(e="ranTag"+Math.floor(999999*Math.random())){for(this.name=e;e in t.tagExist;)e+="_";t.tagExist[e]=!0}tid=u.TypeId.SimTag;toString(){return this.name}},t.AND="and",t.OR="or",t.NOT="not",t.NAND="nand",t.NOR="nor",t.XOR="xor",t.XNOR="xnor",t.and=y,t.or=function(...e){return h(t.OR,e)},t.not=function(e){return[t.NOT,e]},t.nand=function(...e){return h(t.NAND,e)},t.nor=function(...e){return h(t.NOR,e)},t.xor=function(...e){return h(t.XOR,e)},t.xnor=function(...e){return h(t.XNOR,e)},t.select=function(e,t){return t&&(e=y(e,t)),new d(e)},Object.keys(c).filter((e=>!f.includes(e))).forEach((e=>s.globalify.Export(c,e)))},184:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=r(695),s=r(222),a=i(r(54));var u=o.globalify.Export;class c extends a.default{opering;constructor(e){super(),this.opering=e}tipLast=[];tip(...e){this.tipLast.push(s.Template.join(...e))}getTip(){const e=this.tipLast;return this.tipLast=[],e.join("\n")}}t.default=c,n([u],c.prototype,"tip",null)},695:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.parse=t.globalify=void 0;const i=n(r(399)),o=r(935),s=n(r(537));function a({api:e}){a.methodKeys.forEach((t=>globalThis[t]=function r(...n){return this instanceof r?new e[t](...n):e[t](...n)})),a.attributeKeys.forEach((t=>globalThis[t]=e[t]))}t.globalify=a,function(e){e.methodKeys=new Set,e.attributeKeys=new Set,e.Export=function(t,r){("function"==typeof t[r]?e.methodKeys:e.attributeKeys).add(r)},e.clear=function(){e.methodKeys.forEach((e=>delete globalThis[e])),e.attributeKeys.forEach((e=>delete globalThis[e]))}}(a||(t.globalify=a={})),t.parse=async function(e,t,r={}){const n=new o.Operator(e);return r.globalify&&a(n),await t(n.api),r.globalify&&a.clear(),await(0,s.default)(n),(0,i.default)(n.ast,r)}},715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.env=void 0,t.env={defaultLang:"zh-CN",config:{lang:"zh-CN",track:!0},setConfig(e){return Object.assign(this.config,e)}},t.default=t.env},512:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.Tool=t.Text=void 0,t.Text=o(r(473)),t.Tool=o(r(444)),t.Env=r(715),t.env=t.Env.env},473:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.regEnum=t.sureObj=t.getEnumName=t.initText=void 0;const i=n(r(715)),o=r(444);t.initText=function(e){return e};const s=new Map;function a(e){return s.get(e)??(0,o.throwErr)("ErrUnregisteredEnum",Error(),e)}function u(e){return e[i.default.config.lang]??e[i.default.defaultLang]??e[Object.keys(e)[0]]}t.getEnumName=a,t.sureObj=u,t.regEnum=function(...[e,t,r]){s.set(t,e);const n=e=>u(c?.[e]??(0,o.throwErr)("ErrNoEnumText",Error(),a(t),e)),c={};return n.addTranObj=e=>{let r;for(r in e){const n=t[r],o=e[r];c[n]="string"==typeof o?{[i.default.defaultLang]:o}:o}return n},r&&n.addTranObj(r),n}},444:(e,t,r)=>{"use strict";function n(){return n.Imp||(n.Imp=r(509))}Object.defineProperty(t,"__esModule",{value:!0}),t.throwErr=t.getImp=void 0,t.getImp=n,n||(t.getImp=n={}),t.throwErr=function(e,t,...r){return n().errlib.throwErr(n().errlib.EType[e],t,...r)}},689:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetErr=t.EType=t.errs=void 0;const n=r(776),i=r(222);t.errs={ErrNoSuchFile:e=>({files:e}),ErrNoParser:()=>({}),ErrNoSuchErr:e=>({throwTracker:e}),ErrCannotBeImported:e=>({moduleName:e}),ErrUseBeforeDefine:e=>({varName:e}),ErrCannotBeSeted:e=>({varName:e}),ErrIllegalParameter:e=>({args:e}),ErrForgetPathInfo:e=>({node:e}),ErrIllegalVisitorName:e=>({name:e}),ErrNoEnumText:(e,t)=>({enumDomain:e,enumNumber:t}),ErrUnregisteredEnum:e=>({enumObj:e}),ErrInitWithoutGetter:(e,t)=>({domain:e,instance:t}),ErrNotInList:e=>({path:e}),ErrWrongTransfErrorSignal:e=>({error:e})},t.EType=i.Enum.from((0,i.listKeyOf)(t.errs)),t.GetErr=function(...e){const[r,i,...o]=e,s=t.EType[r];return s in t.EType?{type:r,...(0,t.errs[s])(...o),tracker:i}:(0,n.throwErr)(t.EType.ErrNoSuchErr,e[1],Error())}},776:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.holdErr=t.checkHolded=t.trapErr=t.errCatcher=t.throwErr=t.clearErr=t.getTracker=t.EType=void 0;const i=n(r(715)),o=r(473),s=r(689);Object.defineProperty(t,"EType",{enumerable:!0,get:function(){return s.EType}});const a=r(633);let u;function c(e){return{...e,type:(0,a.tranumEType)(e.type)}}function f(...e){const[t]=e;if("object"!=typeof t)return f((0,s.GetErr)(...e));const r=c(t);if(console.error("\n[37m[41m McdJS 错误 [0m",r),"function"!=typeof globalThis.process?.exit)throw r;process.exit(9)}t.getTracker=function(){return i.default.config.track?Error():(0,o.sureObj)(function(){if(u)return u;u={};for(const e in a.some.tracker)u[e]=Error(a.some.tracker[e]);return u}())},t.clearErr=c,t.throwErr=f,t.errCatcher=e=>f(e),t.trapErr=function(e,...t){return()=>e((0,s.GetErr)(...t))};const l=[];t.checkHolded=function(){let e;for(;e=l.pop(),l.length;)e?.()},t.holdErr=function(...e){const t=()=>{clearTimeout(r),f(...e)},r=setTimeout(t),n=l.push(t);let i=!0;return function(e){const t=e;return t.addKey=t=>function(r){return!!e(r)&&(delete this[t],!0)},t}((t=>t?(e[1]=t,f(...e)):!!i&&(delete l[n],clearTimeout(r),i=!1,!0)))}},633:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tranumEType=t.some=void 0;const n=r(473),i=r(689);t.some=(0,n.initText)({tracker:{"zh-CN":"以下追踪信息仅供参考"}}),t.tranumEType=(0,n.regEnum)("EType",i.EType,{ErrNoSuchFile:{"zh-CN":"找不到文件","en-US":"Cannot find such file"},ErrNoParser:{"zh-CN":"没有可用的解析器","en-US":"No available parser"},ErrNoSuchErr:{"zh-CN":"没有这种错误类型","en-US":"Wrong error type"},ErrCannotBeImported:{"zh-CN":"此模块不允许被引入","en-US":"The module is not allowed to be imported"},ErrUseBeforeDefine:"变量在预定义完成前被引用",ErrCannotBeSeted:{"zh-CN":"此变量无法被赋值","en-US":"The variable is not allowed to be assigned"},ErrIllegalParameter:{"zh-CN":"非法的参数","en-US":"Illegal Parameter given"},ErrForgetPathInfo:{"zh-CN":"初始化节点时未注册路径信息","en-US":"Forget to regist PathInfo when initialize a Node"},ErrIllegalVisitorName:{"zh-CN":"错误的访问器名称","en-US":"Illegal vistor name"},ErrNoEnumText:"找不到枚举对应的文本",ErrUnregisteredEnum:"使用了未被注册的枚举",ErrInitWithoutGetter:"未使用要求的工厂函数获取实例",ErrNotInList:"节点不在列表里",ErrWrongTransfErrorSignal:"未知转义错误代码"})},138:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const s=o(r(509));!1===exp?globalThis.McdJS=s:exp.exports=s},696:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.formatMPText=void 0;const s=r(549),a=o(r(696));function u({note:e,cbType:t,command:r,delay:n,conditional:i,redstone:o}){return[`[${[u.getRedstone(o),u.getCbType(t),u.getConditional(i),u.getDelay(n)]}]`,r,e&&`// ${e}`].filter((e=>e)).join(" ")+"\n"}t.default=function({formatter:e}){return"function"==typeof e?e:a[`format${e??"MPText"}`]},t.formatMPText=u,function(e){e.getRedstone=function(e){return null===e?"~":e?"-":"+"},e.getCbType=function(e){switch(e){case s.CbType.Chain:return"L";case s.CbType.Impulse:return"M";case s.CbType.Repeat:return"X";default:return"~"}},e.getConditional=function(e){return null===e?"~":e?"+":"-"},e.getDelay=function(e){return e??"~"}}(u||(t.formatMPText=u={}))},640:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.regGenevent=t.geneventEmtier=void 0;const i=n(r(381)),o=r(232),s=r(610),a=r(537),u=r(222);class c extends u.InitializableMap{initializeValue(){return{entry:[],exit:[]}}}const f=new c;function l(...e){const t=Object.keys(o.Port.genevents).at(-1),r=[];return e.forEach((([e,n])=>{const i=f.forceGet(e);"all"!==n&&"entry"!==n||i.entry.push(t),"all"!==n&&"exit"!==n||i.exit.push(t),r.push(e)})),{ntypes:r}}var p;t.geneventEmtier=new i.default,t.regGenevent=l,function(e){e.Start=l([s.NType.System,"entry"]),e.End=l([s.NType.System,"exit"])}(p||(p={})),a.organizer.addWorker("internal-pack",(async({data:e})=>{e.walk({all:{entry(e){f.get(e.node.ntype)?.entry.forEach((e=>t.geneventEmtier.emit(e)))},exit(e){f.get(e.node.ntype)?.exit.forEach((e=>t.geneventEmtier.emit(e)))}}})}))},950:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.groupMPText=void 0;const s=o(r(950));function a(){return"\n"}t.default=function({grouper:e,formatter:t}){return"function"==typeof e?e:"function"==typeof t?a:s[`group${e??t??"MPText"}`]},t.groupMPText=a},399:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=r(610),a=r(549),u=o(r(696)),c=o(r(950)),f=o(r(508));t.default=async function(e,t){const r=(0,u.default)(t),n=(0,f.default)(t),i=(0,c.default)(t),o=[];return e.nodes.map((e=>{if(e.ntype!==s.NType.CBGroup)return;o.push(i()),e.tips&&o.push(n(e.tips));let t=e.repeat?a.CbType.Repeat:a.CbType.Impulse;o.push(...e.cbs.map(((n,i)=>n.ntype!==s.NType.Command?"":r({cbType:i?a.CbType.Chain:t,command:n.exec,conditional:n.cond,delay:i?e.tick:0,note:n.tips??"",redstone:!1}))))})),{text:(await Promise.all(o)).join(""),ast:e,tips:e.tips,option:t}},i(r(640),t)},508:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.noteMPText=t.noteLog=void 0;const s=r(549),a=r(696),u=o(r(508));function c(e){return`# ${e}\n`}t.default=function({noter:e,formatter:t}){return"function"==typeof e?e:"function"==typeof t?c:u[`note${e??t??"MPText"}`]},t.noteLog=function(e){return(0,a.formatMPText)({note:"Info",cbType:s.CbType.Impulse,command:`say ${e}`,delay:0,conditional:!1,redstone:null})},t.noteMPText=c},232:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Port=void 0,globalThis.McdJSPort={portable:!0,libs:{},genevents:{}},t.Port=globalThis.McdJSPort},509:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.types=t.plugin=t.magast=t.gload=t.generator=t.errlib=t.config=t.appinf=t.api=t.default=void 0,t.default=o(r(509)),t.api=o(r(934)),t.appinf=o(r(695)),t.config=o(r(512)),t.errlib=o(r(776)),t.generator=o(r(399)),t.gload=o(r(232)),t.magast=o(r(935)),t.plugin=o(r(537)),t.types=o(r(523)),r(377)},935:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.PathInfo=t.Operator=t.nodes=void 0,t.nodes=o(r(610));var a=r(19);Object.defineProperty(t,"Operator",{enumerable:!0,get:function(){return s(a).default}});var u=r(604);Object.defineProperty(t,"PathInfo",{enumerable:!0,get:function(){return s(u).default}})},477:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(610);t.default=class{getNode(e,...t){return new(0,n.Node[e])(this.operm,...t)}}},610:function(e,t,r){"use strict";var n=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0}),t.Node=t.tranumNType=t.NType=t.NodeAttr=t.isNodeConstructor=t.isNode=t.Base=void 0,r(929);const i=r(473),o=r(776),s=r(232);class a{static nodeAttr=[];static langObj="未知节点";constructor(e,t=!0){if(this.index=e.plusNodeNum(),t){const t=e.api.getTip();t&&(this.tips=t)}}index;tips}function u(e){return e instanceof a}function c(e){return"function"==typeof e&&u(e.prototype)}function f(e,t){let r;Reflect.hasMetadata("nodeAttr",e)?r=Reflect.getMetadata("nodeAttr",e):Reflect.defineMetadata("nodeAttr",r=[],e),r.push(t)}var l;t.Base=a,t.isNode=u,t.isNodeConstructor=c,t.NodeAttr=f,function(e){class r extends a{ntype=t.NType.Top;static"zh-CN"="树顶空位";constructor(e,t){super(e),this.system=t}system}n([f],r.prototype,"system",void 0),e.Top=r;class i extends a{tips;ntype=t.NType.System;static"zh-CN"="指令系统";constructor(e,t){super(e),this.tips=t}nodes=[]}n([f],i.prototype,"nodes",void 0),e.System=i}(l||(l={})),t.NType={},t.tranumNType=(0,i.regEnum)("NType",t.NType);let p=0;s.Port.Node=new Proxy(l,{set:(e,r,n)=>(c(n)||(0,o.throwErr)(o.EType.ErrIllegalParameter,Error("应为构造函数"),[n]),e[r]=n,t.NType[t.NType[r]=p]=r,t.tranumNType.addTranObj({[r]:n.langObj}),p++,!0)}),Object.assign(s.Port.Node,l),t.Node=McdJSPort.Node},19:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const i=n(r(477)),o=r(610),s=n(r(604)),a=r(780),u=n(r(934));class c extends i.default{constructor(e){super(),this.top=new o.Node.Top(this,this.scope=this.ast=new o.Node.System(this,e))}operm=this;scope;ast;top;nodeNum=0;api=(0,u.default)(this);plusNodeNum(){return this.nodeNum++}push(e){return this.scope.nodes.push(e),new this.api.CommandRsltClass(e.index)}walk(e){new s.default(this,this.ast,this.top,!1,0,"system").walk(e)}plugins=new a.PluginEmiter}t.default=c},604:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(929);const i=r(776),o=n(r(477)),s=r(780),a=r(319);class u extends o.default{node;dad;inList;listIndex;constructor(e,t,r,n,i,o){super(),this.node=t,this.dad=r,this.inList=n,this.listIndex=i,this.operm=e,this.dadKey=o,this.listIn=n?r[o]:null}operm;dadKey;listIn;isInList(){return this.inList}isNotInList(){return this.inList}sure(e){return e===this.node.ntype}notSure(e){return e!==this.node.ntype}sureDad(e){return e===this.dad?.ntype}notSureDad(e){return e===this.dad?.ntype}removed=!1;remove(){if(this.inList||(0,i.throwErr)(i.EType.ErrNotInList,Error(),this),this.removed)return;const e=this.dad[this.dadKey];e.splice(e.indexOf(this.node),1)}walkEmiter(e){try{e.entry(this);for(const t of Reflect.getMetadata("nodeAttr",this.node)||[]){let r,n=this.node[t],i=!0;"length"in n?n=n.slice(0):(n=[n],i=!1);for(r=0;r<n.length;++r)new u(this.operm,n[r],this.node,i,r,t).walkEmiter(e)}e.exit(this)}catch(e){if(a.TransfError.assert(e),e?.cause?.signal===a.TransfSignal.Stop)return;(0,i.throwErr)(i.EType.ErrWrongTransfErrorSignal,e,e)}}walk(e){this.walkEmiter(new s.PluginEmiter(e))}stop(){throw new a.TransfError(a.TransfSignal.Stop)}}t.default=u},780:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluginEmiter=t.getNodesVisited=void 0;const n=r(776),i=r(222),o=r(610),s=r(319);var a;!function(e){function t(...e){return e}e.expressionCalcSig=t(o.NType.ExpressionNot),e.expressionCalcBin=t(o.NType.ExpressionAnd,o.NType.ExpressionNand,o.NType.ExpressionNor,o.NType.ExpressionOr,o.NType.ExpressionXnor,o.NType.ExpressionXor),e.expressionCalc=t(...e.expressionCalcBin,...e.expressionCalcSig),e.expression=t(...e.expressionCalc,o.NType.Selector,o.NType.CommandRslt)}(a||(a={}));const u=(0,i.listKeyOf)(a);function c(e){return"all"===e?i.Enum.valueOf(o.NType):i.Enum.isKeyOf(o.NType,e)?[o.NType[e]]:(t=e,u.includes(t)?a[e]:(0,n.throwErr)(n.EType.ErrIllegalVisitorName,Error(),e));var t}t.getNodesVisited=c;class f{static visitorType=["exit","entry"];constructor(e){if(e){if("addMap"in e)return e;for(const t in e){const r=e[t],n="function"==typeof r?{entry:r}:r;c(t).forEach((e=>this.addMap(e,n)))}}}entryMap=new i.ArrayMap;exitMap=new i.ArrayMap;addMap(e,t){f.visitorType.forEach((r=>t[r]&&this[`${r}Map`].push(e,t[r])))}do(e,t){this[`${e}Map`].get(t.node.ntype)?.forEach((e=>{try{e(t)}catch(e){if(s.TransfError.assert(e),e.cause.signal===s.TransfSignal.Next)return}}))}entry(e){this.do("entry",e)}exit(e){this.do("exit",e)}}t.PluginEmiter=f},319:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.guard=t.TransfError=t.tranumTransfSignal=t.TransfSignal=t.some=void 0;const n=r(473);var i;t.some=(0,n.initText)({report:{"zh-CN":"转义中出现错误"}}),function(e){e[e.Stop=0]="Stop",e[e.Next=1]="Next"}(i||(t.TransfSignal=i={})),t.tranumTransfSignal=(0,n.regEnum)("TransfSignal",i,{Stop:"中断遍历",Next:"结束当前函数"});class o extends Error{static assert(e){if(!(e instanceof o))throw e}constructor(e){super((0,n.sureObj)(t.some.report)),this.cause={signal:e,info:(0,t.tranumTransfSignal)(e)}}cause}t.TransfError=o,t.guard=function(e){if(!e)throw new o(i.Stop)}},537:function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.organizer=void 0;const i=n(r(750));t.organizer=new i.default,t.default=async function(e){return await t.organizer.execute(e),e}},222:(e,t)=>{"use strict";var r,n;Object.defineProperty(t,"__esModule",{value:!0}),t.Template=t.ArrayMap=t.InitializableMap=t.Enum=t.listKeyOf=void 0,t.listKeyOf=function(e){return Object.keys(e)},function(e){const t=new Map;e.keyOf=function(e){if(t.has(e))return t.get(e);const r=n(e,((e,t)=>t));return t.set(e,r),r};const r=new Map;function n(e,t){const r=[];let n=0;for(;n in e;)r.push(t(n,e[n++]));return r}e.valueOf=function(e){if(r.has(e))return r.get(e);const t=n(e,(e=>e));return r.set(e,t),t},e.from=function(e){const t={};return e.forEach(((e,r)=>t[t[e]=r]=e)),t},e.isKeyOf=function(e,t){return"number"==typeof e[t]},e.mapIn=n}(r||(t.Enum=r={}));class i extends Map{forceGet(e){let t=this.get(e);return t||(t=this.initializeValue(),this.set(e,t),t)}}t.InitializableMap=i,t.ArrayMap=class extends i{initializeValue(){return[]}push(e,...t){this.forceGet(e).push(...t)}},function(e){e.join=function(...e){const[{raw:t},...r]=e,n=[];return r.forEach(((e,r)=>n.push(t[r],e))),n.push(t.at(-1)),n.join("")}}(n||(t.Template=n={}))},549:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tranumCbType=t.CbType=t.tranumTypeId=t.TypeId=void 0;const n=r(473);var i,o;!function(e){e[e.CommandRslt=0]="CommandRslt",e[e.Selected=1]="Selected",e[e.SimTag=2]="SimTag"}(i||(t.TypeId=i={})),t.tranumTypeId=(0,n.regEnum)("TypeId",i,{CommandRslt:"命令结果表示",Selected:"选择器表示",SimTag:"标签表示"}),function(e){e[e.Impulse=0]="Impulse",e[e.Chain=1]="Chain",e[e.Repeat=2]="Repeat"}(o||(t.CbType=o={})),t.tranumCbType=(0,n.regEnum)("CbType",o,{Impulse:"脉冲",Chain:"链式",Repeat:"重复"})},523:function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,i)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&n(t,e,r);return i(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.tool=t.game=t.base=void 0,t.base=o(r(222)),t.game=o(r(549)),t.tool=o(r(677))},677:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.revMap=void 0,t.revMap=function(e){const t={};for(const r of Object.keys(e))t[e[r]]=r;return t}},321:function(e,t){"use strict";var r=this&&this.__decorate||function(e,t,r,n){var i,o=arguments.length,s=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,r,s):i(t,r))||s);return o>3&&s&&Object.defineProperty(t,r,s),s};Object.defineProperty(t,"__esModule",{value:!0});const n=[],i=(e,t)=>{n.push(t)};class o{constructor(e={}){if("hold"in e)return e;n.forEach((t=>t in e&&(this[t]=e[t]))),this.checkIdle()}autoCheckIdle=!0;set concurrency(e){e<0&&(e=1/0),this._concurrency=e,this.autoCheckIdle&&this.checkIdle()}get concurrency(){return this._concurrency}_concurrency=1/0;running=0;waiters=[];checkIdle(){for(;this.waiters.length&&this.running<this._concurrency;)this.waiters.shift()(),++this.running}hold(){return new Promise((e=>{let t=()=>{--this.running,this.checkIdle(),t=null};this.waiters.push((()=>e((()=>t?.())))),this.checkIdle()}))}async run(e){const t=await this.hold();try{return await e()}finally{t()}}}t.default=o,r([i],o.prototype,"autoCheckIdle",void 0),r([i],o.prototype,"concurrency",null)}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r(138)})();})(typeof module==="undefined"?false:module);