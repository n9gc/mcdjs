/**
 * 幻想私社异步过程类
 * @version 2.10304.0
 * @license GPL-3.0-or-later
 * @link https://github.com/E0SelmY4V/scpo-proce
 */
!function(){"use strict";var t,n;function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}function o(t,n){if("function"==typeof t)return new A(t,n);var e=new A(null,null,!0);return e.lastRtn=arguments,e}o.isPipe=!0;var r=o.notModule="undefined"==typeof module,i=o.hasObject_keys="function"==typeof(null==Object?void 0:Object.keys),u=o.errAbled="undefined"==typeof console?"alert":"function"==typeof(null===(t=console)||void 0===t?void 0:t.error)?"error":"function"==typeof(null===(n=console)||void 0===n?void 0:n.log)?"log":"none",l=o.apply=function(t,n){switch(n.length){case 0:return t();case 1:return t(n[0]);case 2:return t(n[0],n[1]);case 3:return t(n[0],n[1],n[2]);default:return t.apply(null,n)}},f=o.isThenable=function(t){return"function"==typeof(null==t?void 0:t.then)},c=o.isArrayLike=function(t){return"object"===e(t)&&"number"==typeof(null==t?void 0:t.length)},s=(o.arrayFrom=function(t){for(var n=[],e=0;e<t.length;e++)n.push(t[e]);return n},o.getList=function(t){return c(t[0])?t[0]:t}),a=!1,h=-1,p=1,d=(o.getId=function(){return(a=!a)?h--:p++},o.forIn=function(t,n){for(var e in n)t[e]=n[e]});function g(t){return null!=t&&t._isProceConfig?t:this.set(t)}g.configAll=function(t){return d(g.prototype,t)},g.prototype={actTrap:!0,errlv:"log",todo:null,ordo:null,_isProceConfig:!0,stopTrap:!1},d(g.prototype,i?{set:function(t){return d(this,t),this},get:function(t){var n=new g(t),e=Object.keys(this);if(t)for(var o=e.length-1;o>=0;--o)e[o]in t||(n[e[o]]=this[e[o]]);else for(var r=e.length-1;r>=0;--r)n[e[r]]=this[e[r]];return n}}:{set:function(t){for(var n in this._seted||(this._seted=[]),t)this._seted.push(n),this[n]=t[n];return this},get:function(t){var n=new g(t),e=this._seted;if(t)for(var o=e.length-1;o>=0;--o)e[o]in t||(n[e[o]]=this[e[o]],n._seted.push(e[o]));else for(var r=e.length-1;r>=0;--r)n[e[r]]=this[e[r]],n._seted.push(e[r]);return n},_seted:null}),o.ConfigClass=g,o.config=new g;var y=o.doRtn=function(t,n,e){return t.nmArg?n(e):(t.nmArg=!0,l(n,e))},v=o.act=function(t,n,e){for(var o=[t.ftodo,t.fordo],r=0;null!==(i=r<(null==e?void 0:e.length))&&void 0!==i&&i;r++){var i;o.push(e[r])}try{var u=l(n,o);f(u)&&t.config.actTrap&&u.then(null,t.fordo),t.acted=!0}catch(n){t.acted=!0,t.fordo(n)}},w=o.clear=function(t,n){for(var e=t.queuetodo,o=t.pointer;++o<e.length;)if("function"==typeof e[o])try{n=y(t,e[o],n)}catch(e){t.pointer=o,n=m(t,e),o=t.pointer}t.lastDef=setTimeout((function(){return t.then(t.config.todo,t.config.ordo)})),t.lastRtn=n,t.cleared=!0},m=o.exeordo=function(t,n){for(var e=t.queueordo,o=t.pointer;++o<e.length;)if("function"==typeof e[o]){t.pointer=o;try{return y(t,e[o],n)}catch(n){return m(t,n)}}return t.pointer=o,b(t,t.nmArg?n:n[0]),n},b=o.toss=function(t,n){var e=t;e.lastErr=setTimeout((function(){if(null!==e.lastDef)return b(e,n);switch(e.config.errlv){case"throw":throw n;case"log":switch(u){case"error":console.error("scpo-proce Uncaught",n);case"log":console.log("scpo-proce Uncaught",n);case"alert":try{var t;alert("scpo-proce Uncaught ".concat(null!==(t=null==n?void 0:n.message)&&void 0!==t?t:n))}catch(t){}}}}))};function A(t,n,e){this.queuetodo=[],this.queueordo=[],this.config=new g(n);var o=this,r=!0;e?this.cleared=!0:(this.ftodo=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return r&&(r=!1,w(o,n))},this.fordo=function(){for(var t=arguments.length,n=new Array(t),e=0;e<t;e++)n[e]=arguments[e];return r&&(r=!1,w(o,m(o,n)))},"function"==typeof t&&v(this,t))}A.prototype={ftodo:null,fordo:null,queuetodo:null,queueordo:null,cleared:!1,acted:!1,nmArg:!1,lastRtn:[],lastErr:null,lastDef:null,config:null,pointer:-1,then:function(t,n){if(this.isPipe)return new A(null,null,!0).then(t,n);if(this.cleared){this.pointer++,clearTimeout(this.lastDef),this.lastDef=null;try{null===this.lastErr?"function"==typeof t&&(this.lastRtn=y(this,t,this.lastRtn)):"function"==typeof n&&(clearTimeout(this.lastErr),this.lastErr=null,this.lastRtn=y(this,n,this.lastRtn))}catch(t){b(this,this.lastRtn=t)}}else this.queueordo.push(n),this.queuetodo.push(t);return this},trap:function(t){return this.then(null,t)},next:function(t,n,e){var o=new A,r=this.config.get(e);return this.then((function(){for(var n=arguments.length,e=new Array(n),i=0;i<n;i++)e[i]=arguments[i];return o.config=r,v(o,t,e)}),r.stopTrap||o.fordo),"function"==typeof n?o.trap(n):o},take:function(t,n,e){if(this.isPipe)return new A(null,null,!0).take(t,n,e);"number"==typeof t?e=t:"number"!=typeof e&&(e=-1);var o=this,r=new A((function(t,n){o.then((function o(){for(var r=arguments.length,i=new Array(r),u=0;u<r;u++)i[u]=arguments[u];return f(i[0])&&0!=e--?i[0].then(o,n):l(t,i)}),n)}));return"function"==typeof t||"function"==typeof n?r.then(t,n):r},grab:function(t,n,e,o){return this.take(e).next(t,n,o)},conf:function(t){if(this.isPipe)return new A(null,null,!0).conf(t);var n=this;return this.then((function(){return n.config=n.config.get(t)}))},configAll:function(t){return this.then((function(){return g.configAll(t)}))},todo:function(){var t=new A(null,null,!0);return t.lastRtn=arguments,t},ordo:function(){var t=new A(null,null,!0);return b(t,(t.lastRtn=arguments)[0]),t},all:function(){var t=s(arguments),n=[[]],e=t.length,o=e;return new A((function(r,i){for(;--e>=0;)f(t[e])?function(e){t[e].then((function(){for(var t=arguments.length,i=new Array(t),u=0;u<t;u++)i[u]=arguments[u];for(var f=i.length;--f>=0;)(n[f]||(n[f]=[]))[e]=i[f];0==--o&&l(r,n)}),i)}(e):(--o,n[0][e]=t[e]);o||l(r,n)}))},one:function(){var t=s(arguments),n=new A((function(e,o){for(var r=0;r<t.length;r++){if(!f(t[r]))return n.acted?void 0:e(t[r]);t[r].then(e,o)}}));return n},snake:function(){var t=s(arguments),n=this;return new A((function(e,o){for(var r=0;r<t.length;r++)n=n.next(t[r]);n.then(e,o)}))}},A.prototype[["ca","ch"].join("t")]=A.prototype.trap,o.Proce=A;for(var R=A.prototype,k=["then","trap","next","take","catch","grab","conf","configAll","todo","ordo","snake","all","one"],_=k.length-1;_>=0;--_)o[k[_]]=R[k[_]];r?window.scpoProce=o:module.exports=o}();